

Platforme de publication des données Géographiques résiliente
=============================================================

Ce projet vise à créer un serveur permettant la publication de données géographiques de manière résilientes.

Prérequis
---------

Avant de procéder à l'application du projet, il convient :

- D'être muni de trois ordinateurs sous linux (distribution debian ou ubuntu)
- D'avoir docker installé sur les 3 machine : [tuto](https://docs.docker.com/engine/installation/)
- D'avoir installé Consul sur une des machines : [Téléchargement](https://www.consul.io/downloads.html)
- D'avoir installer docker-compose sur toutes les machines : 
````shell
sudo apt-get install docker-compose
````

Pour monter notre server nous allons avoir besoin de créer notre propre image. Les Dockerfile permettant la création de ces images se trouvent dans les sous-répertoires PostGis1, postGis2 et Geoserver.

Ce projet utilisera 2 Geoserver ainsi que deux autres conteneurs dans lesquels on trouvera dans chacun : 
- Une base de données postgresql avec l'extension postgis
- Un daemon pgpool permettant la réplication des bases de données

La fabrication de ces images sont décrites 





## Geoserver 
dockerfile pour fabriquer l'image fini.
login : admin 
mot de passe : geoserver

## NGNIX 
partie à revoir.

## Postgres
- dockerfile pour fabriquer l'image de postgis.
- définir le maitre et l'esclave pour faire la replication dans le cas d'un mise à jour de la base de données (pas terminer)

## Docker compose 
à finir 


gosu postgres postgres --single <<- EOSQL
CREATE USER $USERNAME WITH PASSWORD '$PASSORD';
CREATE DATABASE $DB TEMPLATE template0 ENCODING 'UNICODE';
ALTER DATABASE $DB OWNER TO $USERNAME;
GRANT ALL PRIVILEGES ON DATABASE $DB TO $USERNAME;



cat > /var/lib/postgresql/data/pg_hba.conf <<EOS
# Generated by fix-acl.sh
# TYPE  DATABASE        USER            ADDRESS                 METHOD
# "local" is for Unix domain socket connections only
local   all             all                                     trust
# IPv4 local connections:
host    all             all             127.0.0.1/32            trust
# IPv6 local connections:
host    all             all             ::1/128                 trust
# Allow anyone to connect remotely so long as they have a valid username and 
# password.
host all all 0.0.0.0/0 md5
EOS


 volumes:
  - ./data:/var/lib/postgresql/data
 