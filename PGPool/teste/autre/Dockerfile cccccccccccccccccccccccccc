FROM debian
MAINTAINER <Groupe Amiri>

RUN  apt-get update \
  && apt-get install -y wget \
  && rm -rf /var/lib/apt/lists/*

RUN \
  wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - && \
  echo "deb http://apt.postgresql.org/pub/repos/apt/ jessie-pgdg main" > /etc/apt/sources.list.d/pgdg.list && \
  apt-get update && \
  useradd -m -u 5432 postgres && \
  apt-get install -yq postgresql-client-9.4 && \
  apt-get install -yq postgresql-server-dev-9.4 && \
  apt-get install -yq libpq-dev && \
  apt-get install -yq libpgpool0 && \
  apt-get clean && \
  rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

RUN wget http://www.pgpool.net/download.php?f=pgpool-II-3.3.3.tar.gz
RUN tar xvfz download.php?f=pgpool-II-3.3.3.tar.gz

RUN apt-get update && apt-get install -y \
    build-essential \
    make \
    gcc \
   

RUN cd pgpool-II-3.3.3
RUN ./configure
RUN make
RUN make install
RIN mkdir /var/run/pgpool

ADD ./pgpool.conf /usr/local/etc/pgpool.conf
ADD ./pcp.conf /usr/local/etc/pcp.conf
ADD ./pgpool.conf /usr/local/etc/pgpool.conf
ADD ./pool_hba.conf /usr/local/etc/pool_hba.conf

EXPOSE 9999

ADD start.sh /tmp/start.sh
RUN chmod 777 /tmp/start.sh
ENTRYPOINT ["/tmp/start.sh"]


